<!DOCTYPE html>
<meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<title>QR Code</title>
<style>
  @import url("peersky://static/css/qr.css");
</style>
<div class="qr-background">
  <div class="example">
    <qr-code id="qr" data-fg="saddlebrown" data-bg="lemonchiffon"></qr-code>
  </div>
  <button id="download" disabled>Download</button>
</div>

<script src="peersky://static/elves/elf.js" type="module"></script>
<script type="module">
  document.addEventListener("DOMContentLoaded", () => {
    const urlParams = new URLSearchParams(window.location.search);
    const url = urlParams.get("url") || "peersky://home";
    const qr = document.querySelector("#qr");
    qr.setAttribute("src", url);

    const downloadBtn = document.getElementById("download");

    // Enable download button once QR code renders
    setTimeout(() => (downloadBtn.disabled = false), 1000);

    downloadBtn.addEventListener("click", () => {
      const qrImage = document.querySelector("qr-code img");
      if (!qrImage) {
        alert("QR code not generated yet!");
        return;
      }

      const link = document.createElement("a");
      link.href = qrImage.src;
      link.download = "qr-code.png";
      link.click();
    });
  });
</script>
